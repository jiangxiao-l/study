# 项目部署及ansible

## 1. 在Linux的系统下进行项目的部署

```python
1.将项目打包 和数据库的数据打包一起传到 /opt 目录下 并解压项目文件

2. 在数据库中创件建用户
     启动数据库：systemctl strat mysqld
     登入：MySQL
     创建数据库： create database blog charset utf8mb4;
     将原来的数据库中的数据录入新建的数据库中：
          use blog
          source /opt/blog.sql
      创建用户和授权：
        grant select,update,delete ,insert on blog.* to blog@'10.0.0.%'               identified by '123';(填内网ip)
        
   3.修改Django中的settings.py 的文件：
           DATABASES = {
                    'default': {
                        'ENGINE': 'django.db.backends.mysql',
                        'NAME': 'blog',
                        'HOST': "10.0.0.100",（填内网Ip）
                        'USER': 'blog',
                        'PASSWORD': '123',
                        'PORT': 3306,
                    }
                }     
        
   4.对nginx配置文件的修改：
        vim /etc/nginx/conf.d/py.conf
        server {
        listen 80;
        server_name 10.0.0.100;（公网ip）
        client_max_body_size 100M;

        location  /static {
        alias /opt/BBS/static/;
        }

        location /media {
        alias /opt/BBS/media;
        }

        location / {
        index index.html;
        include uwsgi_params;
        uwsgi_pass 127.0.0.1:9090; （内网ip）
        uwsgi_param UWSGI_SCRIPT BBS.wsgi;
        uwsgi_param UWSGI_CHDIR /opt/BBS;
        }
        }

          
   5. 配置uwsgi：
      
   关闭所有已有的uwsgi进程：kill -9 `ps -ef |grep uwsgi|awk {'print $2'}
   
   vim  uwsgi.ini (注意路径 在BBS项目下创建)
    [uwsgi]
        socket = 127.0.0.1:9090  （内网ip）
        master = true
        workers = 2
        reload-mercy = 10
        vacuum = true
        max-requests = 1000
        limit-as = 512
        buffer-size = 30000
        
   6.启动uwsgi： uwsgi --ini uwsgi.ini &
   
   7. 启动nginx：systemctl start nginx 
    
```

## 2. anlible的介绍

```

1. 安装ansible
wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo

curl -o /etc/yum.repos.d/CentOS-Base.repohttp://mirrors.aliyun.com/repo/Centos-7.repo

yum install ansible -y


2.克隆虚拟机及配置
  2.1.修改主机名： hostnamectl set-hostname standby: 

  2.2 修该配置文件：
     vim /etc/sysconfig/network-scripts/ifcfg-eth0
         IPADDR=10.0.0.200
         UUID行删掉
         
     vim /etc/hosts
         10.0.0.200 standby

   23.查看IP地址：systemctl restart network
   
 3. Linux的 SSHD(22)
        验证方式:
        (1)用户+密码(PAM)
        (2)秘钥验证(公钥:钥匙和私钥:锁)
            通过秘钥对实现,需要将公钥分发到各节点


4.管理被控端，管理机先生成秘钥，然后推送公钥

ssh-keygen
ssh-copy-id -i ~/.ssh/id_rsa.pub root@10.0.0.200

[root@demo ~]# for i in {1..12};do ssh-copy-id -i ~/.ssh/id_rsa.pub root@10.0.0.$i;done

```

