# Django_orm

## 一、orm连接数据库的前期操作

```
---1. 如果连接的是MySQL：在settings里配置
  'default': {
				'ENGINE': 'django.db.backends.mysql',
				'HOST': '127.0.0.1',
				'PORT': 3306,
				'USER': 'root',
				'PASSWORD': 'admin',
				'NAME': 'lqz',
			}
			
 ---- 2. 在app下的__init__.py里写:
		import pymysql
		pymysql.install_as_MySQLdb()
		
 ---- 3. 在model文件中创建数据表
        class User(models.Model):
            #自增int类型 是主键
            id = models.AutoField(primary_key=True)
            name = models.CharField(max_length=32)
             pwd = models.CharField(max_length=32)
             
  -----4. 数据的迁移（在终端中实现）
     ---Python3 manage.py makemigrations --> 记录一下数据库的变化(会在migration文件夹的下面                                               产生一个 0001_inital.py文件)
    ---- Python3 manage.py migrate  -->  将变化的同步到数据库中(会在数据库中生成一个关于user表)

                	 	
             


```



## 二、 orm的介绍

```
	--- tools  Run manage.py Task（快捷键）
    --- python3 manage.py makeemigrations (记入数据库的修改记录)
    --- python3 manage.py migrate (把数据同步到数据库中)

```

## 三、 orm能干和不能干的事情

```
     1. 能够创建数据表，能够对立面的数据进行增删改查
     2. 不能创建数库
```

## 四、字段的操作

```
 ---orm新增字段:(注意数据库的迁移命令2条)
		注意：后来新增的字段，需要有默认值
        设置默认值：eg: phone = models.CharFiled(max_lenght = 32 ,default = “120”)

----orm删除字段：
		注释掉字段，然后执行数据库的迁移命令
 
-----orm修改字段：
		直接修改字段，执行数据库的迁移命令

```

## 五、数据表的简单的增删改

### 1. 数据的查询

```
 单表查询所有用户:models.User.objects.all() 
 注： 得到的是 queryset对象(当成列表),列表里面,一个一个的对象[user1,user2]
 
 orm查询单条数据:user=models.User.objects.filter(id=id).first()
 注：得到的user的对象
```

### 2.数据的删除

```
 models.User.objects.filter(id=id).delete()
 返回值:影响的行数
```

### 3. 数据的修改

```
models.User.objects.filter(id=id).update(name=name,password=pwd,address=addr)
```

### 4. 数据的添加

```
放式一：	   	
user=models.User.objects.create(name=name,password=pwd,address=addr)
方法二：
user=models.User(name=name,password=pwd,address=addr)
user.save()
```

## 六、基于orm实现增删改查

```
思路：

一. 查：all
      1.  利用obj = models.User.object.all()得到所有的数据
      2.  利用 return render(request,’info.html’,{‘obj’:obj})的方式将得到的数据映射到                  info.html文件中，通过for循环将其的对象遍历出来，然后同过 obj.id 映射到页面上

二：删：delete
      1. 在info.html文件中通过传输id的方式得到要删除的对象
       Eg: <a herf = ‘/delete ?id = {{ info.id }}’></a>
      2. 在视图函数中，利用request.GET.get(‘id’)得到要删除的对象
      3. 删除对象：models.User.object.fliter(id = id).delete()
                4. 重定向到info的页面 ： return  redirect(‘/info/’)

  三：增加：create
     1. 在info.html文件中,添加一个连接
         <a herf =‘/adduser’>添加用户</a>
     2. 在视图函数中接收如果是 判断如果是以get的方式发送过来的数据，
        就利用return render(request, 'adduser.html')的方式，转跳到里一个页面中，实现数据的添            加，然后再由<from action = ‘/adduser’ method=‘post’>，将数据传送给视图函数
     3. 在视图函数中，判断页面传输的方式post，得到真实的数据，
     4. 将数据更新到数据库中 create
     5. 重定向到info方法中

  四.编辑：update
     1. 在info.html中通过传输id的方式，知道修改的对象
     2. 在视图函数中，利用get的方式得到id 和 内容传输update.html文件
     3. 在update.html 文件中，也是同样利用相同的方式，将数据传送给视图函数
     4. 在视图函数中，将得到的数据更新到数据库中 
     5. 重定向到info视图函数中

```

