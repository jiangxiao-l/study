#  BBS项目

## 一、注册

### 1.利用forms组件

```python
from  django import forms

from django.forms import  widgets

from django.core.exceptions import  ValidationError

from blog import  models


class UserForm(forms.Form):
    username = forms.CharField(max_length=8,min_length=3,label='用户名',required=True,
                               error_messages={'max_length': '最长是8', 'min_length': '最短是3', 'required': '这个必须填'},
                               widget =widgets.TextInput(attrs={'class':'form-control'})
                               )
    password = forms.CharField(max_length= 18, min_length=3, label='密码',required=True,
                               error_messages={'max_length': '最长是8', 'min_length': '最短是3', 'required': '这个必须填'},
                               widget=widgets.PasswordInput(attrs={'class': 'form-control'})
                               )
    re_password = forms.CharField(max_length=18, min_length=3, label='确认密码',required=True,
                                  error_messages={'max_length': '最长是8', 'min_length': '最短是3', 'required': '这个必须填'},
                               widget=widgets.PasswordInput(attrs={'class': 'form-control'})
                               )

    phone = forms.CharField(max_length=11, min_length=11, label='电话号码', required=True,
                               error_messages={'max_length': "号码长度为11", 'min_length': '号码长度为11', 'required': '这个必须填'},
                               widget=widgets.PasswordInput(attrs={'class': 'form-control'})
                               )
    blog_id   = forms.CharField(label='blog',required=True,
                            widget=widgets.TextInput(attrs={'class': 'form-control'})
                            )

    email = forms.EmailField(label='邮箱',required=True,
                             error_messages={'required': '这个必须填'},
                             widget = widgets.TextInput(attrs={"class":'form-control'})
                             )

    #局部钩子
    def clean_username(self):
        username = self.cleaned_data.get('username')
        #去数据库校验
        ret = models.UserInfo.objects.filter(username=username).first()
        if ret:
            raise ValidationError('用户已经存在')
        return  username

    #全局钩子
    def clean(self):
        password = self.cleaned_data.get('password')
        re_password = self.cleaned_data.get('re_password')
        if password and re_password:
            if password == re_password:
                return  self.cleaned_data
            else:
                raise  ValidationError('两次密码不一致')

```

### 2.前端的代码

```html

// 利用form组件的熏染

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/static/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <script src="/static/jquery-3.3.1.js"></script>
    <title>登录</title>
    <style type="text/css">
        #avatar{
            display: none;
        }
        
    </style>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-6 col-md-offset-3">
            <h1>注册</h1>
            <form id = 'form'>
                {% csrf_token %}

                {% for form in forms %}
                    <div class="form-group">
                        <lable for="{{ form.auto_id }}">{{ form.label }}</lable>
                        {{ form }}<span  style="color: red;"></span>
                    </div>
                {% endfor %}

                {#  avatar#}
                <div class="form-group">
                    <label for="avatar">头像
                        <img src="/static/img/default.png" alt="" id='img_file' width="80" height="80"
                             style="margin-left: 10px">
                    </label>
                    <input type="file" id="avatar">
                </div>
            </form>
            <span id='sp2' style="color:red"></span>
            <input type="button" value="注册" class="btn btn-primary pull-right">

        </div>
    </div>
</div>
</body>
<script>

    {#头像的处理#}
    $('#avatar').change(function () {
        //先取出文件
        var file_obj = $('#avatar')[0].files[0];
        // 通过文件阅读器，把图片放到img的标签上
        // 生成一个文件的阅读器对象
        var filereader = new FileReader();
        // 将图片对象，读到filereader对象的值
        filereader.readAsDataURL(file_obj);
        // 把文件的对象渲染到img标签上，(等加载完毕后，在操作)
        filereader.onload = function () {
            $('#img_file').attr('src', filereader.result)
        }
    });


    {#点击发送数据#}
    
    {# 第一种方法：直接将数据append到formdata里面#}
    $(".btn").click(function () {
        var formdata = new FormData();
        formdata.append('username', $('#id_username').val());
        formdata.append('password', $('#id_password').val());
        formdata.append('re_password', $('#id_re_password').val());
        formdata.append('phone', $('#id_phone').val());
        formdata.append('email', $('#id_email').val());
        formdata.append('blog_id', $('#id_blog_id').val());
        formdata.append('csrfmiddlewaretoken', $("[name=           	      'csrfmiddlewaretoken']").val());
        
        formdata.append('avatar', $('#avatar')[0].files[0]);
        
     
       '''
          {# 第二种方法：直接将数据append到formdata里面#}
        //$('#form').serializeArray()把form表单打包，转成对象（字典）
            var arr=$("#form").serializeArray()
        // jQuery的循环，穿参数：第一个参数是循环的对象，第二个参数是匿名函数
            $.each(arr,function(key,obj){
                // obj对象的就是{name: "name", value: "sfdae"}
                formdata.append(obj.name,obj.value)
            })
         formdata.append('avatar', $('#avatar')[0].files[0]);
       注：必须将文件的数据另外添加进去
       
        '''
        
        
        $.ajax({
            url: "/register/",
            type: "post",
            contentType: false,
            processData: false,
            data: formdata,
            success: function (data) {
                if (data === '1') {
                    alert('注册成功');
                    location.href = 'http://127.0.0.1:8000/login/'
                }
                // 实现错误信息的渲染
                else {
                    //在此之前就清除
                    $('.form-group').removeClass('has-error');
                    $('.sapn_error').html("");
                    // 全局的错误信息的渲染
                    $("#sp2").text(data.all_error);
                    // 局部和自定义的错误信息的渲染
                    $.each(data.errors, function (key, value) {
                        str = "#id_" + key;
                        $(str).next('span').text(value[0])

                    })

                }

            }
        })
    })
    
    
    $('#id_username').blur(function(){
        $.ajax({
            url:"/register/",
            type:'post',
            data:{
                'username':$('#id_username').val(),
                'csrfmiddlewaretoken':$('[name ="csrfmiddlewaretoken"]').val()
            },
            success:function(data){
                $('#id_username').next('span').text(data.errors.username)
            }

        })
   
    })
</script>
</html>

```

### 3.后端的代码

```python
# 先导入必要的组件和模块
from blog import myform 
# 注册
def register(request):
    if request.method == 'GET':
        # 做页面的渲染使用
        forms = myform.UserForm()
        return render(request, 'register.html', locals())

    elif request.method == 'POST':
        # 做数据的校验
        forms = myform.UserForm(request.POST)
        # 判断数据是否正确(只有运行了这句话，才进行数据的校验)
        if forms.is_valid():
            # 得到干净的数据
            dic = forms.cleaned_data

            # 删除re_password字段的数据
            dic.pop('re_password')
            # 取出文件的对象
            avatar = request.FILES.get('avatar')
            # 判断：如果没有文件就选择默认的图片
            if avatar:
                dic['avatar'] = avatar

            # 存入数据

            UserInfo.objects.create_user(**dic)

            return  HttpResponse(1)
        else:
            #将错误的信息放在一个字典里面，发送到前端做渲染。
     		 dic = {'errors': forms.errors, 'all_error': None}
             #得到全局的错误信息
            all_error = forms.errors.get('__all__')
            if all_error:
                all_error = all_error[0]
                dic["all_error"] = all_error

            return JsonResponse(dic)
```

## 二、登入

### 1.创建随机验证码

```python
from django.shortcuts import  HttpResponse
# 对图片的管理
from PIL import Image, ImageDraw, ImageFont
import random
# 内存管理
from io import BytesIO

# 创建出随机的数据
def get_random_color():
    return (
        random.randint(0, 255), random.randint(0, 255), random.randint(0, 255)
    )


# 创建出随机验证码
def get_valid_code(request,id): // 在路由上应该添加一个配置一个路由分组
    
       if len(id) > 0:
            if id[-3:-2] == '1':
                num = 100
            else:
                num = id[-2:len(id) + 1]
                num = int(num)
        else:
            num = 100
            
    char_list = []
    li = []

    img = Image.new('RGB', (325, 35), color=get_random_color())
    # 拿到画笔,把图片传入画笔
    img_draw = ImageDraw.Draw(img)

    # 生成一个字体对象,第一个参数是字体文件的路径,第二个参数是字体大小
    font = ImageFont.truetype('static/font/ss.TTF', size=25)

    # 第一个参数,xy的坐标,第二个参数:要写的文字,第三个参数:写文字的颜色,第四个参数:字体
    # 不同的字体是不同的ttf文件

    # 随机得到五个随机数
    for i in range(0, 5):
        random_num = random.randint(0, 9)
        random_upper_char = chr(random.randint(65, 90))
        random_lower_char = chr(random.randint(97, 122))
        random_char = random.choice([random_num, random_lower_char, random_upper_char])
        char_list.append(random_char)

    # 将所有的数据不变为字符串
    for i in char_list:
        if type(i) == int:
            i = str(i)
        li.append(i)

    char_str = ''.join(li)

    img_draw.text((0, 0), char_str, get_random_color(), font=font)

    width = 320
    height = 35
    
    for i in range(num/10):
        x1 = random.randint(0, width)
        x2 = random.randint(0, width)
        y1 = random.randint(0, height)
        y2 = random.randint(0, height)
        # 在图片上画线
        img_draw.line((x1, y1, x2, y2), fill=get_random_color())

    for i in range(num):
        # 画点
        img_draw.point([random.randint(0, width), random.randint(0, height)], fill=get_random_color())
        x = random.randint(0, width)
        y = random.randint(0, height)
        # 画弧形
        img_draw.arc((x, y, x + 4, y + 4), 0, 90, fill=get_random_color())



    f = BytesIO()
    # 把图片保存到f中
    # 放到内存中,存取比较快,而且有自动清理
    img.save(f, 'png')
    # 得到存中的值
    data = f.getvalue()

    # 将得到的随机数存放到session中，便于以后的校验
    request.session['char_str'] = char_str

    return HttpResponse(data)

```

### 2.前端的代码

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/static/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <script src="/static/jquery-3.3.1.js"></script>
    <title>登录</title>

</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-6 col-md-offset-3">
            <h1>登录</h1>
        {# label for="name"  如果指定某个id,这样点击这个label,焦点会到对应的控件上 #}
            <form>
                {% csrf_token %}
                <div class="form-group">
                    <label for="name">用户名</label>
                    <input type="text" id="name" class="form-control">
                </div>
                <div class="form-group">
                    <label for="pwd">密码</label>
                    <input type="password" id="pwd" class="form-control">
                </div>
                <div class="form-group">
                    <label for="valid_code">验证码</label>
                    <div class="row">
                        <div class="col-md-6" >
                            <input type="text" id="valid_code" class="form-control">
                        </div>
                        <img  src="/get_valid_code/" alt="" id = 'img_code'>
                        <p><span id="span"></span></p>
                    </div>
                </div>

                <input type="button" value="登录" class="btn btn-primary pull-right">
            </form>

        </div>

    </div>

</div>
</body>
<script>
    var num =100
     {# 实现验证码的点击更新   #}
    $('#img_code').click(function () {
        $('#img_code')[0].src = $('#img_code')[0].src + num  
        num = num-30 
    });

    {# 实现点击发送数据#}
    $('.btn').click(function () {

        var url = document.location.href;
        var openid = url.split("next=")[1];

       $.ajax({
           //实现登录后重定向到原来的页面上
           url:"/login/?next="+openid,
           type:'post',
           data:{
               'valid_code':$('#valid_code').val(),
               'name':$('#name').val(),
               'pwd':$('#pwd').val(),
               'csrfmiddlewaretoken':$('[name="csrfmiddlewaretoken"]').val()
           },
           success:function (data) {
                if(data ===  "1"){
                    $('#span').text('验证码输入错误').css('color','red');

                }
                else if (data ===  "3" ){
                    $('#span').text('密码或者账号错误').css('color','red');

                }
                else{
                    if (data ===  'undefined'){
                      location.href= 'http://127.0.0.1:8000/index/'
                    }
                    else{
                        location.href=data
                    }

                }
           }
       })
    })

</script>
</html>
```

### 3.后端的代码

```python
# 登入
def login(request):
    if request.method == 'GET':
        return render(request, 'login.html')

    if request.method == 'POST':
        char_str = request.session.get('char_str')
        valid_code = request.POST.get('valid_code')
        next = request.GET.get('next')

        # 判断随机数是否一样
        if not char_str.upper() == valid_code.upper():
            return HttpResponse(1)

        name = request.POST.get('name')
        pwd = request.POST.get('pwd')
        user = auth.authenticate(request, username=name, password=pwd)
        if user:
            auth.login(request, user)
            return HttpResponse(next)
        else:
            return HttpResponse(3)
```

## 三、主页的设置

### 1.后端代码

```python
def index(request):
    if request.method == 'GET':
        article_list = Article.objects.all()
        return render(request, 'mainpage.html', locals())
```

### 2. 前端代码

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/static/bootstrap-3.3.7-dist/css/bootstrap.css">
    <script src="/static/jquery-3.3.1.js"></script>
    <script src="/static/bootstrap-3.3.7-dist/js/bootstrap.js"></script>
    <style type="text/css">
        span{
            margin-right: 5px;
        }
    </style>
    <title>主页</title>
</head>
<body>
<div class="head">
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="https://www.cnblogs.com/">博客园</a>
            </div>

            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#">文章 <span class="sr-only"></span></a></li>
                    <li class="active"><a href="#">随笔 <span class="sr-only"></span></a></li>
                </ul>

                <ul class="nav navbar-nav navbar-right">
                    {% if request.user.is_authenticated %}
                        <li><a href="{% url 'userblog' request.user.username %}">{{ request.user.username }}</a></li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                               aria-haspopup="true"
                               aria-expanded="false">设置中心 <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="/change_pwd/">修改密码</a></li>
                                <li><a href="/change_avatar/">修改图像</a></li>
                                <li role="separator" class="divider"></li>
                                <li><a href="/logout/">注销</a></li>
                            </ul>
                        </li>
                    {% else %}
                        <li><a href="/login/">登入</a></li>
                        <li><a href="/register/">注册</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>


</div>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-2">
            <div class="panel panel-default">
                <div class="panel-heading">重金求子</div>
                <div class="panel-body">
                    月薪：￥66666
                </div>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">草榴社区</h3>
                </div>
                <div class="panel-body">
                    <a href="http://www.baidu.com">点击进入</a>
                </div>
            </div>

        </div>
        <div class="col-md-7">
            {% for article in article_list %}
                <div style="margin-top:20px">
                    {# 文章的标题 #}
                    <h4><a href="/{{  article.blog.userinfo.username }}/article/{{ article.pk }}">{{ article.title }}</a></h4>
                    <div class="media" >
                        <div class="media-left">
                            <a href="#">
                                {#  用户名的头像显示  #}
                                <img class="media-object" src="/media/{{ article.blog.userinfo.avatar }}" height="70" width="70">
                            </a>
                        </div>
                        <div class="media-body">
                            {# 文章的摘要 #}
                            {{ article.desc }}
                        </div>
                    </div>
                    <div style="margin-top: 10px " class="article_bottom">
                        <span><a href="">{{ article.blog.userinfo.username }}</a></span>
                        <span>发布于 {{ article.create_time|date:'Y-m-d H:i:s' }}</span>
                        {#反向查询,一对多,按表名小写_set#}
                        <span class="glyphicon glyphicon-comment"><a href="">评论({{ article.commit_set.count  }})</a></span>
                        <span class="glyphicon glyphicon-thumbs-up"><a href="">点赞({{ article.up_num }})</a></span>
                        <hr>
                    </div>
                </div>
            {% endfor %}


        </div>
        <div class="col-md-3">
            <div class="panel panel-default">
                <div class="panel-heading">重金求子</div>
                <div class="panel-body">
                    月薪：￥66666
                </div>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">草榴社区</h3>
                </div>
                <div class="panel-body">
                    <a href="http://www.baidu.com">点击进入</a>
                </div>
            </div>
        </div>

    </div>
</div>

</body>
</html>
```

### 3.图像显示的设置

```python

1. 在setting文件里面设置： 
        MEDIA_URL="/media/"
        MEDIA_ROOT=os.path.join(BASE_DIR,"media")
        
2. 在url.py文件里设置：

		// 先导入必要的模块
		from django.views.static import  serve
        from  . import settings
        
        //在urlpatterns添加一条：
          url(r'^media/(?P<path>.*)', serve,{'document_root':settings.MEDIA_ROOT})
```

## 四、修改密码

### 1.后端的代码

```python
def change_pwd(request):
    if request.method == 'GET':
        return render(request, 'change_pwd.html', locals())
    elif request.method == 'POST':
        re_pwd = request.POST.get('re_pwd')
        if len(re_pwd) > 18 or len(re_pwd) < 3:
            return HttpResponse(1)
        else:
             username = request.POST.get('username')
             pwd = request.POST.get('pwd')
             user = auth.authenticate(request, username=username, password=pwd)
            if not user:
                return HttpResponse(2)
            else:
                # 全部成功完成修改密码
                user = request.user
                user.set_password(re_pwd)
                user.save()
                auth.logout(request)
                return HttpResponse(3)
```

### 2.前端的代码

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/static/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <script src="/static/jquery-3.3.1.js"></script>
    <title>修改密码</title>

</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-6 col-md-offset-3">
            <h1>修改密码</h1>
            <form>
                {% csrf_token %}
                 <div class="form-group">
                    <label for="username">用户名</label>
                    <input type="password" id="username" class="form-control">
                </div>
                <div class="form-group">
                    <label for="pwd">原密码</label>
                    <input type="password" id="pwd" class="form-control">
                </div>
                <div class="form-group">
                    <label for="re_pwd">新密码</label>
                    <input type="password" id="re_pwd" class="form-control">
                    <span style="color:red" id = 'span'></span>

                </div>

                <input type="button" value="修改" class="btn btn-primary pull-right">
                <span style="color:red" id = 'span1'></span>
            </form>

        </div>

    </div>

</div>
</body>
<script>
    $('.btn').click(function () {
        $.ajax({
            url:"change_pwd",
            type:"post",
            data:{
                'username':$('#username').val(),
                'pwd':$('#pwd').val(),
                're_pwd':$('#re_pwd').val(),
                 'csrfmiddlewaretoken':$('[name = "csrfmiddlewaretoken"]').val()
            },
            success:function (data) {
               if(data == '1'){
                   $('#span').text('密码长度范围在3-18');

               }
               else if(data == '2'){
                   $("#span1").text('密码或者账号错误');

               }
               else{
                   alert('密码修改成功');
                   location.href='http://127.0.0.1:8000/index'
               }

            }


        })
    })




</script>

</html>
```

## 五、修改头像

### 1. 后端代码

```python
def change_avatar(request):
    if request.method == 'GET':
        return render(request, 'change_avatar.html')

    elif request.method == 'POST':
        avatar = request.FILES.get('avatar')
        user= request.user
        user.avatar = avatar
        user.save()
        return HttpResponse('修改成功')
```

### 2. 前端代码

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/static/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <script src="/static/jquery-3.3.1.js"></script>
    <title>修改头像</title>
    <style type="text/css">
        #avatar {
            display: none;
        }

    </style>
</head>
<body>
<p> 修改头像 </p>
<div class="form-group">
    {% csrf_token %}
    <label for="avatar">头像
        <img src="/static/img/default.png" alt="" id='img_file' width="80" height="80"
             style="margin-left: 10px">
    </label>
    <input type="file" id="avatar">
    <button id='btn'>提交</button>
</div>
<script>
    {#头像的处理#}
    $('#avatar').change(function () {
        //先取出文件
        var file_obj = $('#avatar')[0].files[0];
        // 通过文件阅读器，把图片放到img的标签上
        // 生成一个文件的阅读器对象
        var filereader = new FileReader();
        // 将图片对象，读到filereader对象的值
        filereader.readAsDataURL(file_obj);
        // 把文件的对象渲染到img标签上，(等加载完毕后，在操作)
        filereader.onload = function () {
            $('#img_file').attr('src', filereader.result)
        }

    });

    $('#btn').click(function () {
        var formdata = new FormData();
        formdata.append('csrfmiddlewaretoken', $("[name= 'csrfmiddlewaretoken']").val());
        formdata.append('avatar', $('#avatar')[0].files[0]);
        $.ajax({
            url: "/change_avatar/",
            type: "post",
            contentType: false,
            processData: false,
            data: formdata,
            success: function (data) {
                alert(data);
                location.href = 'http://127.0.0.1:8000/index/'

            }
        })


    })


</script>
</body>
</html>
```



## 六、注销

### 1.后端代码

```python
def logout(request):
    if request.method == 'GET':
        auth.logout(request)
        return redirect('/index/')

```

### 2.前端代码

```html
直接在主页上设值一个链接： <li><a href="/logout/">注销</a></li> 
```

## 七、个人主页的设置

### 1. 设计的思路

```

1. 在输入框上输入用户名的名字，就可以进入该用户的主页

2. 每个用户都有自己的主题

3. 由于在后面显示文章的内容的时候，还需要继承左边的内容，所以考虑将上面和左边的部分，单独写在一个base.html文件中，其余的继承，在此基础上添加信息，即可。。但是有考虑到，不同功能的上传给前端的数据是不一样的，考虑到代码的简便，将base.html里面的左边的数据，用一个inclusion_tag 进行渲染

4.url的设计：  
   必须放在最后面：
   url(r'^(?P<username>[\w]+)/$', views.user_blog,name='userblog'),
   
 5. 如何给左侧的数据进行数据的过滤显示：
 
 		1. url的设置(在页面上输入用户名+分类的名字+id)：
 		
 		url(r'^(?P<username>[\w]+)/(?P<condition>category|tag|archive)/(?      	               P<param>.*)',views.user_blog),
 		
 		2. 将过滤得到的文章的内容传到前端（后面的后端的代码上）
 		
 		
 
			
```

### 2、具体的实现

#### I. templatestags文件

```python

1.自定义一个templatetags的文件：名字必须为：templatetags，写一个py文件

my_tag.py 文件： 

from django.template import Library
from django.db.models.functions import TruncMonth
from blog import models
from django.db.models import Count
register = Library()


@register.inclusion_tag('classify.html')
def classify(username):
    user = models.UserInfo.objects.filter(username=username).first()
    blog = user.blog
   
  // 得到该用户下的每个分类下的文章数
    
 category_num=models.Category.objects.all().filter(blog=blog)
           .annotate(coun=Count('article__title')).values_list('title', 'coun', 'pk')
    
    
  // 得到改用户下的每个标题的文章的数目

 tag_num=models.Tag.objects.all().filter(blog=blog)
    .annotate(coun=Count('article__title')).values_list('title', 'coun', 'pk')
    
    
 // 得到该用户下的每个相同的月份的文章数

  y_m_num=models.Article.objects.all().filter(blog=blog)     .annotate(y_m=TruncMonth('create_time')).values('y_m').annotate(coun=Count('y_m')).values_list('y_m', 'coun')
    
  // 将数据以字典的形式，传递给classify.html 文件
 return {'category_num': category_num, 'tag_num':tag_num,'y_m_num':y_m_num,
         'username':username}

```

#### II. classify.html 文件

```html
<div>
    <div class="panel panel-primary">
        <div class="panel-heading">我的标签</div>
        <div class="panel-body">
            {% for foo in tag_num %}
                <p><a href="/{{ username }}/tag/{{ foo.2 }}">{{ foo.0 }}({{ foo.1 }})</a></p>
            {% endfor %}

        </div>
    </div>

    <div class="panel panel-primary">
        <div class="panel-heading">我的分类</div>
        <div class="panel-body">
            {% for foo in category_num %}
                <p><a href="/{{ username }}/category/{{ foo.2 }} ">{{ foo.0 }}({{ foo.1 }})</a></p>
            {% endfor %}

        </div>
    </div>

    <div class="panel panel-primary">
        <div class="panel-heading">随笔档案</div>
        <div class="panel-body">
            {% for foo in y_m_num %}
                <p><a href="/{{ username }}/archive/{{ foo.0|date:"Y-m" }}">{{ foo.0|date:"Y-m" }}({{ foo.1 }})</a></p>
            {% endfor %}

        </div>
    </div>
</div>
```

#### III. base.html文件

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ blog.userinfo.username }}的个人博客</title>
    <link rel="stylesheet" href="/static/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/{{ request.user.username }}.css">
    <script src="/static/jquery-3.3.1.js"></script>
    <link rel="stylesheet" href="/static/css/mycss.css">

    <style>
        * {
            margin: 0;
            padding: 0;
        }

    </style>
</head>
<body>
<div class="head">

    <p style="margin-left: 20px">{{ blog.title }}</p>
</div>
<div class="container-fluid" style="margin-top: 30px;">
    <div class="row">
        <div class="col-md-3">
                // 导入my_tag文件，对其进行渲染，并传值
            
                {% load my_tag %}
                {% classify  username %}

        </div>
        <div class="col-md-9">
             // 留一个盒子，在继承的模板中，可以继续扩展
            
             {% block content %}
             {% endblock %}
            </div>
        </div>
    </div>
</div>
</body>
</html>
```

#### IV. userblog.html文件(前端的主页)

```html
//  只需要填写文章的部分


// 先到入基表，在block中添加数据

{% extends 'base.html' %}

{% block content %}
    {#通过站点查询所有文章,反向查询,按表名小写_set.all#}

    {% for article in article_list %}
        <div>
        <h4><a href="/{{ username }}/article/{{ article.pk }}">{{ article.title }}</a></h4>
        <div class="media">
            <div>
                {{ article.desc }}
            </div>

            <div style="margin-top: 10px " class="article_bottom small">


                <span>posted @ {{ article.create_time|date:'Y-m-d H:i:s' }}</span>


                <span>{{ article.blog.userinfo.username }}</span>
                <span><i class="fa fa-comment" aria-hidden="true"><a
                        href="">评论({{ article.commit_num }})</a></i></span>


                <span class="glyphicon glyphicon-thumbs-up"><a href="">点赞({{ article.up_num }})</a></span>
                <span><a href="">编辑</a></span>
            </div>
            <hr>
        </div>
        </div>
    {% endfor %}

{% endblock %}

```

#### V. 后端的代码

```python
def user_blog(request, username, *args, **kwargs):
    
    // *args, **kwargs  是为了得到有名分组的数据
    
    user = UserInfo.objects.filter(username=username).first()
    if not user:
        return render(request, 'error.html')

    username = username
    blog = user.blog
    # 每个用户的所有的文章数  是用于显示主页上的数据
    article_list = blog.article_set.all()
    
    // 是用于过滤时用的数据
    
    condition = kwargs.get('condition')     // 得到前端传过来具体的数据
    
    param = kwargs.get('param')     //  id 号
    
    if 'tag' == condition:
        
        # 指定标签的文章，在总的文章上，再进行过滤 基于双下划綫的查询,正向查询
        article_list = article_list.filter(tag__pk = param)


    elif 'category' == condition:
        
        # 指定每个分类下的文章，在总文章上下，在进行过滤 
        article_list = article_list.filter(category__pk = param)


    elif "archive" == condition:
        archive_list = param.split('-')
        article_list = article_list.filter(create_time__year                 =archive_list[0],create_time__month =archive_list[1])

    return render(request, 'userblog.html', locals())
```

## 八、显示文章的内容

### 1. 后端代码

```python
def article_detail(request,username,id):
    
    // user 和 blog 必须带，在后台的数据进行数据的渲染，显示上面的座右铭
    
    user = UserInfo.objects.filter(username = username).first()
    blog = user.blog

    article = Article.objects.filter(pk = id).first()
    
    // 将评论的数据传递给前端做评论的展示
    commit_list = Commit.object.filter(article=article)
    return  render(request,'article_detail.html',locals())
```

### 2. 前端代码

```html
// 还是继承了base.html的文件

{% extends 'base.html' %}

{% block content %}
    <div>
        // 文章的标题
        <p><h4 class="text-center">{{ article.title }}</h4></p>
       
		// 文章的主要内容
        <div> {{ article.content|safe }}</div>
   
    </div>

    <div id="div_digg" style="float:left;">
        {% csrf_token %}
        {#点赞#}
        <div class="diggit">
            <span class="diggnum" id="digg_count">{{ article.up_num }}</span>
        </div>
        {#点踩#}
        <div class="buryit">
            <span class="burynum" id="bury_count">{{ article.down_num }}</span>
        </div>

        <div class="clear"></div>

        <div class="diggword" id="digg_tips"></div>
        <a href="#" style="display: none;">请先<span style="color:red">登入</span></a>
    </div>

{#点赞点踩： 实现ajax的数据传输#}
    <script>
       $(".diggit").click(function () {
           $.ajax({
               url:'/diggit/',
               type:"post",
               data:{
                   'article_id':"{{ article.pk  }}",
                    'is_up':true,
                     'csrfmiddlewaretoken':$('[name="csrfmiddlewaretoken"]').val()
               },
               success:function (data) {

                   if(data == '1'){
                       $('a').css('display','block')
                   }
                   else{
                       alert(data);
                       location.href = window.location.href
                   }

             }
           })
       }) 

    </script>
{% endblock %}
```

## 九、点赞点踩和评论的实现

### 1.后端的代码

```python

// 点赞点踩的代码
def diggit(request):
    if request.is_ajax():
        //判断用户是否已经登入
        user = request.user.is_authenticated()
        if  not user:
            // 返回前台，提示用户登入
            return HttpResponse(1)
        else:
            // 得到前端传过来的数据
            user  = request.user
            article_id  = request.POST.get('article_id')
            
            // 判断此用户是否已经点赞过此篇文章
            ret = UpAndDown.objects.filter(user=user ,article_id=article_id).first()
            if ret:
                // 如果是的话，就禁止其点赞，并给出提示信息
                return HttpResponse(2)
            else:
                
                // 得到数据，并将数据转成bool类型的值
                is_up = request.POST.get('is_up')
                is_up = json.loads(is_up)
                // 判断是否是点赞
                if is_up == True:
                    //利用原子型操作(如果有一个没有完成，就会回滚。即同时实现或则都不实现)
                    with transaction.atomic():
                        Article.objects.filter(pk = article_id).update(up_num = F('up_num')+1)
                        UpAndDown.objects.create(user  = user,article_id=article_id,is_up = is_up)
                        return  HttpResponse(3)
                else:
                    // 判断是否是点踩
                    with transaction.atomic():
                        Article.objects.filter(pk=article_id).update(down_num=F('down_num') + 1)
                        UpAndDown.objects.create(user__username=user, article_id=article_id, is_up=is_up)
                        return HttpResponse(4)
                    
                    
                    
                    
// 评论的代码：
def commit(request):
    response = {}
    if request.method == 'POST':
        ret = request.user.is_authenticated()
        if not ret:
            # 如果没有登入。
            return HttpResponse(1)
        else:
          // 拿到数据进行保存
            user = request.user
            article_id = request.POST.get('article_id')
            content = request.POST.get('content')
            pid = request.POST.get('pid')
            with transaction.atomic():
                ret = Commit.objects.create(user=user,article_id=article_id,content=content,parent_id=pid)
                Article.objects.filter(pk = article_id).update(commit_num=F('commit_num')+1)

                # 得到相应的数据传递给前端
                response["user"] = ret.user.username
                response['commit_time'] = ret.commit_time.strftime('%Y-%m-%d %X')
                response["content"] = ret.content
                if pid:
                  response['parent_name'] = ret.parent.user.username

                return JsonResponse(response)
```

### 2.前端的代码

```html
{% extends 'base.html' %}
{% block content %}
    <div>
        <p><h4 class="text-center">{{ article.title }}</h4></p>
        <div>
            {{ article.content|safe }}

        </div>

    </div>
    {#点赞点踩#}
    <div class="clearfix">
        <div id="div_digg">
            {% csrf_token %}
            {#点赞#}
            <div class="diggit action">
                <span class="diggnum" id="digg_count">{{ article.up_num }}</span>
            </div>
            {#点踩#}
            <div class="buryit action">
                <span class="burynum " id="bury_count">{{ article.down_num }}</span>
            </div>
            <div class="clear"></div>
            <div class="diggword " id="digg_tips"></div>
            <span class="span" style="color:red"></span>
        </div>
    </div>



    {# 评论的内容#}
    <div style="margin-bottom: 50px">
        <p>评论列表</p>
        <ul class="list-group cotent_ul">

            {% for comment in comment_list %}
                <li class="list-group-item">
                    <p>
                        <span>#{{ forloop.counter }}楼</span>
                        <span>{{ comment.commit_time|date:'Y-m-d H:i:s' }}</span>
                        <span><a href="/{{ comment.user.username }}/">{{ comment.user.username }}</a></span>
                        <span class="pull-right replay" username="{{ comment.user.username }}"
                              content_id="{{ comment.pk }}">回复</span>
                    </p>


                    {% if comment.parent %}
                              <p>{{ comment.parent.user.username  }}:{{ comment.parent.content }}</p>
                              <p>{{ comment.user.username  }}@{{ comment.parent.user.username }}</p>

                        {% endif %}
                     {{ comment.content }}


                </li>
            {% endfor %}


        </ul>
    </div>




    {# 发表的评论框#}
    <div>
        <p>发表评论</p>
        <p>
            昵称：<input type="text" id="tbCommentAuthor" class="author" disabled="disabled" size="50"
                      value="{{ request.user.username }}">
        </p>
        <p>评论内容：</p>
        <p>
                <textarea name="" id="content" cols="60" rows="10">

            </textarea>
        </p>
        <button class="btn btn-primary submit">提交</button>
        <p><span class="sp2"></span>
        <p>

    </div>


    <script>
   
        {#点赞点踩： 实现ajax的数据传输#}
        $(".action").click(function () {
            // 判断是否有diggit 这个属性，如果有就是Turn，没有就是False
            var is_up = $(this).hasClass("diggit");
            
            //对数据的处理，将点赞点踩的数量的变为整型 
            var up_num = $('.diggnum').text();
            up_num = Number(up_num);
            var down_num = $('.burynum').text();
            down_num = Number(down_num);
            $.ajax({
                url: "/diggit/",
                type: "post",
                data: {
                    "article_id": '{{ article.pk }}',
                    'is_up': is_up,
                    "csrfmiddlewaretoken": $('[name="csrfmiddlewaretoken"]').val()
                },           
                success: function (data) {

                    // 1 登入 2 只能点赞在一次 3 点赞成功 4 点踩成功
                    if (data == '1') {
                        $('.span').html('请先登入')
                    }
                    else if (data == '2') {
                        $('.span').html('只能点一次')
                    }
                    else if (data == '3') {
                        $('.span').html('点赞成功');
                        $('.diggnum').text(up_num + 1);
                    }
                    else {
                        $('.span').html('点踩成功');
                        $('.burynum').text(down_num + 1);
                    }

                }

            })


        });

         
        {# 根评论 和 子评论 #}
        var pid = '';
        $('.submit').click(function () {
            var content = $("#content").val();

            if (pid) {
                //有pid才切
                // 拿到content要切的其实位置indexof(),取到指定的索引值
                var index = content.indexOf('\n') + 1;
                content = content.slice(index)
            }

            $.ajax({
                url: "/commit/",
                type: "post",
                data: {
                    "article_id": '{{ article.pk }}',
                    "content": content,
                    "csrfmiddlewaretoken": $('[name="csrfmiddlewaretoken"]').val(),
                    'pid': pid,
                },
                success: function (data) {
                    if (data == '1') {
                        $('.sp2').text('请先登入')
                    }
                    else {
                        alert('评论成功');
                        $('#content').val("");
                         var time = data.commit_time;
                         var user = data.user;
                         var content = data.content;
                        if (pid) {
                            // 清空pid
                            pid = '';
                            var parent_name = data.parent_name;
                            ss = `
                            <li class="list-group-item">
                         <p>
                         <span>${ user }</span>
                            <span>${ time }</span>
                        </p>
                            <p class="well">@${parent_name }</p>
                        ${content}
                    </li>

                            `
                        }
                        else {
                            var ss = `
                      <li class="list-group-item">
                        <p>
                            <span>${ user }</span>:
                            <span>${ time }</span>
                        </p>
                         ${content}
                    </li>
                    `;
                        }
                        $(".cotent_ul").append(ss)
                    }
                }

            })
        });


     

        {# 先实先点击回复时，框内内容的变化#}
        $('.replay').click(function () {
            var username = $(this).attr('username');
            $('#content').val('@' + username + '\n');
            $('#content').focus();
            //给pid赋值（pid是评论的id）
            pid = $(this).attr('content_id')
        })

    </script>

{% endblock %}
```

## 十、 后台管理

### 1、设计分析

```
1、 在前端页面上，布局：上面一个头(后台管理)，左下面是一个框，右边显示内容

2. 将上面和左边的内容放在一个base.hrml的文件中，然后其余的内容均可以继承此页面

3. 在页面的添加文章的过程中，使用了有个富文本的组件(需要下载，并导入使用)

4. 在使用富文本的是时候，在遇到上传图片时，要注意相应的操作

5. 在取文件的概要的时候，要注意两点（利用了bs4 模块）：
                            将后台含有script的内容去除；
                            只显示页面的文本内容，不提取标签





```

### 2、前端的代码

####        I. back_base.html

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/static/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <script src="/static/jquery-3.3.1.js"></script>
    <script src="/static/bootstrap-3.3.7-dist/js/bootstrap.js"></script>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
        }

        .head {
            height: 60px;
            background-color: #2aabd2;
            margin-bottom: 20px;
        }


    </style>
</head>
<body>
<div class="head">
    <p style="text-align: center;line-height: 60px; font-size: 18px">后台管理</p>
</div>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-3">
             <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="headingOne">
                        <h4 class="panel-title">
                            <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne"
                               aria-expanded="true" aria-controls="collapseOne">
                                操作
                            </a>
                        </h4>
                    </div>
                    <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel"
                         aria-labelledby="headingOne">
                        <div class="panel-body">
                            <a href="/add_article/">添加文章</a>
                        </div>
                    </div>
                    <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel"
                         aria-labelledby="headingOne">
                        <div class="panel-body">
                            <a href="#">添加随笔</a>
                        </div>
                    </div>
                    <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel"
                         aria-labelledby="headingOne">
                        <div class="panel-body">
                            <a href="#">其他操作</a>
                        </div>
                    </div>
                </div>
            </div>


        </div>
        <div class="col-md-9">
            <div>
                <!-- Nav tabs -->
                <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab"
                                                              data-toggle="tab">文章</a></li>
                    <li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">随笔</a>
                    </li>
                    <li role="presentation"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">日志</a>
                    </li>
                    <li role="presentation"><a href="#settings" aria-controls="settings" role="tab" data-toggle="tab">链接</a>
                    </li>
                </ul>
                <!-- Tab panes -->
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="home">
                        {% block home %}
                        {% endblock %}


                    </div>
                    <div role="tabpanel" class="tab-pane" id="profile">随笔页面</div>
                    <div role="tabpanel" class="tab-pane" id="messages">日志页面</div>
                    <div role="tabpanel" class="tab-pane" id="settings">链接页面</div>
                </div>

            </div>
        </div>



        </div>

    </div>

</div>


</body>
</html>
```

#### II. back.html

```html
// 继承了backend_base.html 的文件
// 只显示文章的呢内容信息

{%  extends 'backend_base.html' %}
{% block home %}

    <table class="table table-hover table-striped">
    <thead>
      <tr>
          <th>文章标题</th>
          <th>发布时间</th>
          <th>评论数</th>
          <th>点赞数</th>
          <th>修改</th>
          <th>删除</th>
      </tr>
    </thead>
    <tbody>
      {% for article in article_list %}
      <tr>
          <td><a href="/{{ blog.userinfo.username }}/article/{{ article.pk }}">{{ article.title }}</a></td>
          <td>{{ article.create_time|date:"Y-m-d H-i-s" }}</td>
          <td>{{ article.commit_num}}</td>
          <td>{{ article.up_num}}</td>
          <td><a href="/article_update/{{ article.pk }}">修改</a></td>
          <td><a href="/article_delete/{{ article.pk  }}">删除</a></td>
      </tr>
      {% endfor %}
    </tbody>
</table>

{% endblock %}
```

#### III. article_add.html

```html
<!DOCTYPE html>
{% extends 'backend_base.html' %}
{% block home %}
    <div style="margin-top: 20px">
         <p>添加文章</p>
        <form action="/article_update" method="post">
            {% csrf_token %}
            <p>标题内容：</p>
            <p><input type="text" name="title" class="form-control" id = 'title' value="{{ article.title  }}"></p>
             <p>随笔内容(KindEdit编辑器，不支持拖放/粘贴上传图片)</p>
            <p>
                <textarea name="content" id ="editor_id" cols="30" rows="10"  ></textarea>

            </p>

            <p>
                <input type="submit" value="提交">

            </p>

        </form>


    </div>

      //利用了富文本框实现文本输入
        <script charset="utf-8" src="/static/kindeditor/kindeditor-all.js"></script>
        <script>
        KindEditor.ready(function (K) {
            window.editor = K.create('#editor_id', {
                width: '100%',
                height: '500px',
                //item 控制要显示的控件
                resizeType: 0,

                // 上传图片的步骤
                uploadJson:'/upload_img/',

                //添加一些额外的参数
                 extraFileUploadParams:{
                    'csrfmiddlewaretoken':'{{ csrf_token }}'
                },

                // 设置图片的名字
                  filePostName:'myfile'

            })

        });


    </script>
    <script>

              {#$('#editor_id').val("{{ content }}")#}


    </script>



{% endblock %}
```

#### IV . article_updata.html

```html
<!DOCTYPE html>
{% extends 'backend_base.html' %}
{% block home %}
    <div style="margin-top: 20px">
         <p>添加文章</p>
        <form action="/article_update/{{ article.pk }}" method="post">
            {% csrf_token %}
            <p>标题内容：</p>
            <p><input type="text" name="title" class="form-control" id = 'title' value="{{ article.title  }}"></p>
             <p>随笔内容(KindEdit编辑器，不支持拖放/粘贴上传图片)</p>
            <p>
                <textarea name="content" id ="editor_id" cols="30" rows="10" value = "{{ content }}"  ></textarea>

            </p>

            <p>
                <input type="submit" value="提交">

            </p>

        </form>


    </div>

        <script charset="utf-8" src="/static/kindeditor/kindeditor-all.js"></script>
        <script>
        KindEditor.ready(function (K) {
            window.editor = K.create('#editor_id', {
                width: '100%',
                height: '500px',
                //item 控制要显示的控件
                resizeType: 0,

                // 上传图片的步骤
                uploadJson:'/upload_img/',

                //添加一些额外的参数
                 extraFileUploadParams:{
                    'csrfmiddlewaretoken':'{{ csrf_token }}'
                },

                // 设置图片的名字
                  filePostName:'myfile'

            })

        });


    </script>
    <script>

              {#$('#editor_id').val("{{ content }}")#}


    </script>



{% endblock %}
```



### 3、后端的代码

####  1. 后端主页的代码

```python
@login_required(login_url='/login/')
def backend(request):
    if request.method == 'GET':

        blog  = request.user.blog
        article_list = Article.objects.filter(blog=blog)
        return  render(request,'backend.html',locals()
```

#### 2. 添加文章

```python
from bs4 import  BeautifulSoup

@login_required(login_url='/login/')
def add_article(request):
    if request.method == 'GET':
        return  render(request,'add_article.html')
    elif request.method =='POST':
        tittle = request.POST.get('tittle')
        content = request.POST.get('content')
        # 第一各参数是：要解析的内容，第二个参数是：以什么解析器，解析我的页面
        soup = BeautifulSoup(content,'html.parser')


        # 同过bs4模块，去掉script，处理xss攻击
        # 查出所有的标签
        tags = soup.find_all()
        for tag in tags:
            if tag.name == 'script':
                # 删除含有script的标签
                tag.decompose()

        desc = soup.text[0:150]
        Article.objects.create(title=tittle,content=str(soup),desc=desc,blog=request.user.blog,)
        return  redirect('/backend/')

```

#### 3. 富文本上传图片

```python
import  os
from BBS import  settings
# 图片的上传
def upload_img(request):
    myfile = request.FILES.get('myfile')
    path = os.path.join(settings.BASE_DIR,'media','img')
    if not os.path.isdir(path):
        os.mkdir(path)
    file_path = os.path.join(path,myfile.name)
    with open(file_path,'wb')as f :
        for line in myfile:
            f.write(line)
    '''
       //成功时
        {
                "error" : 0,
                
                "url" : "http://www.example.com/path/to/file.ext"  保存的路径
        }
        //失败时
        {
                "error" : 1,
                "message" : "错误信息"
        }
    
    
    '''

    dic = {'error':0,'url':"/media/img/%s"%myfile.name}
    return  JsonResponse(dic)
```

#### 4. 文章的删除

```python
def article_delete(request,id):
    if request.method == 'GET':
        Article.objects.filter(pk =id).delete()
        return  redirect('/backend/')
```

#### 5. 文章的修改

```python
def article_update(request,id):
    if request.method == 'GET':
        article = Article.objects.filter(pk =id).first()
        content = article.content
        # content  = BeautifulSoup(content, 'html.parser').text
        return render(request,'article_update.html',locals())

    elif  request.method == 'POST':
        title = request.POST.get('title')
        content = request.POST.get('content')
        # 第一各参数是：要解析的内容，第二个参数是：以什么解析器，解析我的页面
        soup = BeautifulSoup(content, 'html.parser')

        # 同过bs4模块，去掉script，处理xss攻击
        # 查出所有的标签
        tags = soup.find_all()
        for tag in tags:
            if tag.name == 'script':
                # 删除含有script的标签
                tag.decompose()

        desc = soup.text[0:150]
        Article.objects.filter(pk = id).update(title=title, content=str(soup), desc=desc,)
        return redirect('/backend/')
```

## 十一、发送邮件

```python
--注：在评论成功后向作者发送邮件

--settings.py文件的操作：

    EMAIL_HOST = 'smtp.qq.com'  # 如果是 163 改成 smtp.163.com   以什么邮箱发送
    EMAIL_PORT = 465    #端口号
    EMAIL_HOST_USER = '306334678@qq.com'  # 帐号 发送者邮箱账号
    EMAIL_HOST_PASSWORD = 'odokxrzlfejkcbbh'  #发送者的授权码(要进入邮箱设置)
    DEFAULT_FROM_EMAIL = EMAIL_HOST_USER  #这样收到的邮件，收件人处就会这样显示
    #DEFAULT_FROM_EMAIL = 'lqz<'306334678@qq.com>'
    
    EMAIL_USE_SSL = True   #使用ssl,qq只支持这种
    
 -- 在后端的代码
 
 from BBS import settings  // 先导入settings.py 文件 
 sfrom django.core.mail import send_mail
 from threading import Thread
  # 实例化
   '''
    subject:邮件标题
    message:邮件内容
    from_email:邮件发送者
    recipient_list:接收者列表,可以传多个
    
    '''

t1 = Thread(target=send_mail, args=('您的%s文章被%s评论了' % (atricle_name, usre_name), '这个人评论了:%s' % (content,), settings.EMAIL_HOST_USER,['616564099@qq.com']))
 t1.start()
    
  //因为发邮件的方式是同步的,所以可以利用开线程的方式发送邮件，

```

