# Django_views(视图函数层)

## 一、视图层之HttpRequest对象

```
# 前台Post传过来的数据,包装到POST字典中
# request.POST

# 前台浏览器窗口里携带的数据,包装到GET字典中
# request.GET

# 前台请求的方式
# request.method

# post提交的数据,body体的内容,前台会封装成:name=lqz&age=18&sex=1
# request.body

# 取出请求的路径,取不到数据部分
# print(request.path)

# 取出请求的路径,能取到数据部分 
# print(request.get_full_path())
# print(request.META)

```

## 二、视图层之HttpResponse对象

```
三件套:render,HttpResponse,redirect

--render: return render(request,'index.html',local())
		
--HttpResponse: HttpResponse('字符串')

--redirect：redirect('/index/')  --> 重定向到另一个页面上

```

## 三、视图层之JsonResponse对象

```
from django.http import JsonResponse

def info(request):
    if request.method == 'GET':
        obj = models.Info.objects.all()
        info_list = []
        for info in obj:
            info_dic = {"name": info.name, 'age': info.age, 'sex': info.sex}
            info_list.append(info_dic)
        return JsonResponse(info_list, safe=False, json_dumps_params={'ensure_ascii': False})
        
     注：JsonResponse 括号里面 默认只可以方字典  利用safe=False 可以传任何的类型
         json_dumps_params={'ensure_ascii': False} 可以解决编码的问题
            
```

## 四、CBV  和 FBV

```
-CBV:基于类的视图
	-1 路由层:url(r'^test/', views.Test.as_view()),
	-2 视图层
		-导入:from django.views import View
			-写一个类:
				class Test(View):
					def get(self, request):#一定要传request对象
						return HttpResponse('get-test')
						
                     def post(self, request):
				         return HttpResponse('post-test')
				         
- FBV： 基于函数的视图

```

## 五、简单的文件上传

```
---前端的代码：up.html

    <form action="" method="post" enctype="multipart/form-data">
    
       // 上传文件用：type="file"  method="post"   enctype="multipart/form-data"
       
        <input type="file" name="myfile">
    	<input type="submit" value="提交">
    </form>
    
    
  ---视图函数的代码：  相同文件名的不会覆盖
  		import  os
        import time
        import hashlib

        DIR_PATH=os.path.dirname(os.path.dirname(__file__))
        DB_PATH=os.path.join(DIR_PATH,'media')

  
  
  def up(request):
    if request.method == 'GET':
        return render(request, 'up.html')
        
    elif request.method == 'POST':
    
        //得到问件的内容 重点：文件的对象在 request.FILES 里面 
        
        myfile = request.FILES.get('myfile')
        name = myfile.name
        
       
       // 实现MD5 的操作
        datatime = time.strftime('%Y%m%d%H%M%S',time.localtime())
        file_path = datatime + name
        md = hashlib.md5()
        md.update(file_path.encode('utf-8'))
        file_path = md.hexdigest()

        path = os.path.join(DB_PATH,file_path)
        with open(path, 'wb')as f:
            for line in myfile:
                f.write(line)
        return  HttpResponse('ok')
```

