# Django_多表查询

## 一、一对多的关系

```
 book--> pbulish 	

-- 添加记录：
      Eg:添加一本北京出版社的书
      方式一： 
        ret =Boot.object.create(name=’jjj’,price = ’12.22’,publish_id = 1)
       方式二：
        Publish = Publish.object.filter(pk/id =1)
        Ret = book.object.create(name=’jjjj’,’price=’12.2222’,publish = publish)

-- 修改记录
		   Eg:book = Book.object.filter(id=1).update(publish_id = 2)
         
--删除记录 与单表的删除相似 会有级联删除 同时影响

```

## 二、多对多的关系

```
book ———> authors 
--增加add
       Eg:为红楼梦新增一个刘清政的作者
			方式一：
			Ter = Book.object.filter(name = ‘红楼梦’).first()
			Auth = Author.object.filter(name=’刘清政’).first()
            Book.authors.add(auth)   可以用对象来添加
			方式二：
 				Book.authors.add(1)  也可以用id号来添加
			
 -- 删除：remove
		Book.authors.remove(1) 	
		Book.authors.remove(auth)
          
 -- 清空：clear
           Book.authors.clear()
         
 -- set(先清空在设置),括号内要加一个列表
	  Book.authors.set([1,2,])
```

## 三、基于对象的跨表查询

```
注：
	 正向：在有关联字的基础上开始查询时，为正向查询  
     反向：反之 
```

### 1.一对一的查询

```
author --> authorsdetails
正向：按照字段取
反向：按照类名小写取

正向：按照字段取 取出刘清政的手机号码
      Lqz =authors.objects.filter(name=’刘清政’).first()
	  Phone =lqz.authorsdetails(字段名).phone
  
反向：按照类名的小写取 取出地址是山东的作者
      Ad = AuthorsDetail.objects.filter(addr=’山东’).first()
	  Auth = Ad.authors(类名的小写) 

```

### 2.一对多的查询

```
book-->publish
正向：按照字段取
反向：按照类名小写_set.all()


正向：查询红楼梦出版商的邮箱
        Book= Book.objects.filter(name=’红楼梦’).first()
 	 	Email = book.publish.email
  
反向：查询地址是北京的出版社的书
       Publish= publish.objects.filter(addr=’北京’).first()
	   Book = publish.book_set.all()
	   
```

### 3.多对多的查询

```
正向：按照字段的小写.all()
反向：按照类类名小写的_set.all()


正向：查询红楼梦书籍的所有的作者
     Book= book.objects.filter(name=’红楼梦’).first()
 	 authors = book.authors.all()

  反向：查询刘清政写的所有的书
      Authors = authors.objects.filter(name=’刘清政’).first()
      Book =Authors.book_set.all()
	
```

### 4.连续跨表查询

```
查询红楼梦作者的电话
正向查询：
    Book= book.objects.filter(name =’红楼梦’).first()
	Authors = Book.authors.all()
		for author in Authors:
			phone= author.authorsdefaule.phone
```

## 四、基于双下划线的夸表查询

### 1、一对一的查询

```
authors --> authorsdetails

正向：查询作者为刘清政的手机号
	Ret = Authors.objects.filter(name=’刘清政’).values(‘authorsdatils__phone’)

反向：查询作者为刘清政的手机号
        Ret = authorsdeatils.objects.filter(‘authors__name = ’刘清政’).values(‘phone’)

```

### 2.一对多的查询

```
book --> publish 

1. 查询出版社为北京出版社出版的所有图书的名字,价格
      反向:
      ret = Publish.objects.filter(name='北京出版社').values('book__name','book__price')
      print(ret)

       正向查询
       ret = Book.objects.filter(publish__name ='北京出版社').values('name','price')
       print(ret)
             
2 查询北京出版社出版的价格大于19的书
ret = Publish.objects.filter(name= '北京出版社',book__price__gt=19).values('book__name')
rint(ret)

```

### 3.多对多的查询

```
book- authors

1  查询红楼梦的所有作者名字
       
     正向
         ret = Book.objects.filter(name='红楼梦').values('authors__name')
         print(ret)   
         
     反向：
            ret = Author.objects.filter(book__name='红楼梦').values('name')
            print(ret)

2  查询图书价格大于30的所有作者名字
          
       正向：
           ret = Book.objects.filter(price__gt=30).values('authors__name')
           print(ret)
        
        反向：
             ret = Author.objects.filter(book__price__gt=30 ).values('name')
             print(ret)

```

### 4.双下划线的查询

```
1  查询北京出版社出版过的所有书籍的名字以及作者的姓名
    publish --> book --> authors
    
  ret = Publish.objects.filter(name='北京社').values('book__name','book__authors__name')
  print(ret)


 2 手机号以151开头的作者出版过的所有书籍名称以及出版社名称
     authorsdetails --> auhtors -->book -- publish  
     
 ret=Authordetail.objects.filter(phone__startswith='151').values('author__book__name','author__book__publish__name')
 print(ret)

```

