# wxpy 模块

## 1. 模块的说明书

```python
登陆微信::

    # 导入模块
    from wxpy import *
    # 初始化机器人，扫码登陆
    bot = Bot()

找到好友::

    # 搜索名称含有 "游否" 的男性深圳好友
    my_friend = bot.friends().search('游否', sex=MALE, city="深圳")[0]

发送消息::

    # 发送文本给好友
    my_friend.send('Hello WeChat!')
    # 发送图片
    my_friend.send_image('my_picture.jpg')

自动响应各类消息::

    # 打印来自其他好友、群聊和公众号的消息
    @bot.register()
    def print_others(msg):
        print(msg)

    # 回复 my_friend 的消息 (优先匹配后注册的函数!)
    @bot.register(my_friend)
    def reply_my_friend(msg):
        return 'received: {} ({})'.format(msg.text, msg.type)

    # 自动接受新的好友请求
    @bot.register(msg_types=FRIENDS)
    def auto_accept_friends(msg):
        # 接受好友请求
        new_friend = msg.card.accept()
        # 向新的好友发送消息
        new_friend.send('哈哈，我自动接受了你的好友请求')

保持登陆/运行::

    # 进入 Python 命令行、让程序保持运行
    embed()

    # 或者仅仅堵塞线程
    # bot.join()


```

## 2.  统计微信的男女比例

```python
from wxpy import *
from pyecharts import Pie
import webbrowser

# 初始化机器人，扫码登入
bot = Bot()
# 得到微信上的所有人
friends = bot.friends()
li = {'女': 0, '男': 0, '其他': 0}
for friend in friends:
    if friend.sex == 1:
        li['男'] += 1

    elif friend.sex == 2:
        li['女'] += 1

    else:
        li['其他'] += 1

# 调用图片对象生成一个HTML的图片

pie = Pie('男女比例图')
# 添加数据
pie.add("详情", ["男性", "女性", "未知"], [li['男'], li['女'], li['其他']], is_label_show=True)
# 生成一个页面(重定向)
pie.render('性別统计图.html')

# 调用浏览器打开

webbrowser.open('性別统计图.html')

```

## 3. 统计微信好友的地域分布

```python
from wxpy import *
from pyecharts import  Pie,Map
import webbrowser

# 初始化机器人，扫码登入
bot= Bot(cache_path=True)
# 得到微信上的所有人
friends = bot.friends()
friends_position = {}
for friend in friends:
    if friend.province in friends_position:
       friends_position[friend.province] += 1
    else:
        friends_position[friend.province] =1

print(friends_position)

# 调用图片对象生成一个HTML的图片

map  = Map('好友的地域分布图')
# 添加数据
map.add("地域分布",friends_position.keys(),friends_position.values(),maptype="china",is_label_show=True)
# 生成一个页面(重定向)
map.render('地域分布图.html')
# 调用浏览器打开
webbrowser.open('地域分布图.html')



```

## 4. 实现自动回复的功能

```python
import  requests
import  json
from wxpy import  *

bot = Bot(cache_path=True)
# 锁定要回复的人
friend = bot.search('周毅')[0]

# 借助图灵机器人获取要回复的信息
def auto_reply(text):
    url = "http://www.tuling123.com/openapi/api"
    api_key = "8f99bdf977f74346b4f05f6712336a52"
    payload = {
        "key": api_key,
        "info": text,
    }
    r = requests.post(url, data=json.dumps(payload))
    result = json.loads(r.text)
    return  result["text"]


# 实现自定回复
@bot.register(friend)
def reply_my_friend(msg):
    # 获取收到的信息
     print('收到的信息为：',msg.text)
    # 发送消息
     send_msg = auto_reply(msg.text)

     print("返回的消息：",send_msg)
     return  send_msg


embed()


```

